generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Accounts {
  id                   String               @id @default(uuid())
  username             String               @unique
  role                 roleType
  password             String
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  regionId             String?
  email                String?
  imageUrl             String?
  region               Regions?             @relation(fields: [regionId], references: [id])
  CacheRecords         CacheRecords[]
  responsibleForEvents EventResponsibles[]
  FinancialMovement    FinancialMovement[]
  Inscription          Inscription[]
  PaymentInscription   PaymentInscription[]
  TicketSale           TicketSale[]

  @@map("accounts")
}

model Regions {
  id                 String     @id @default(uuid())
  name               String     @unique
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  outstandingBalance Decimal    @default(0.00) @map("outstanding_balance") @db.Decimal(10, 2)
  accounts           Accounts[]
  events             Events[]

  @@map("regions")
}

model Events {
  id                   String               @id @default(uuid())
  name                 String
  createdAt            DateTime             @default(now())
  regionId             String
  amountCollected      Decimal              @default(0.00) @map("amount_collected") @db.Decimal(10, 2)
  imageUrl             String?              @map("image_url")
  quantityParticipants Int                  @default(0) @map("quantity_participants")
  updatedAt            DateTime             @updatedAt
  endDate              DateTime             @map("end_date")
  startDate            DateTime             @map("start_date")
  location             String?
  latitude             Float?
  longitude            Float?
  status               statusEvent
  paymentEnabled       Boolean              @default(false) @map("payment_enabled")
  EventExpenses        EventExpenses[]
  responsibles         EventResponsibles[]
  EventTickets         EventTickets[]
  region               Regions              @relation(fields: [regionId], references: [id])
  FinancialMovement    FinancialMovement[]
  Inscription          Inscription[]
  OnSiteRegistration   OnSiteRegistration[]
  PaymentInscription   PaymentInscription[]
  typeInscriptions     TypeInscriptions[]

  @@map("events")
}

model EventResponsibles {
  id        String   @id @default(uuid())
  eventId   String   @map("event_id")
  accountId String   @map("account_id")
  account   Accounts @relation(fields: [accountId], references: [id])
  event     Events   @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, accountId])
  @@map("event_responsibles")
}

model TypeInscriptions {
  id          String        @id @default(uuid())
  description String
  value       Decimal       @db.Decimal(10, 2)
  eventId     String        @map("event_id")
  specialType Boolean       @default(false) @map("special_type")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  Participant Participant[]
  event       Events        @relation(fields: [eventId], references: [id])

  @@map("type_inscriptions")
}

model Inscription {
  id                 String               @id @default(uuid())
  accountId          String               @map("account_id")
  eventId            String               @map("event_id")
  totalValue         Decimal              @db.Decimal(10, 2)
  status             InscriptionStatus    @default(PENDING)
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  phone              String
  responsible        String
  email              String?
  account            Accounts             @relation(fields: [accountId], references: [id])
  event              Events               @relation(fields: [eventId], references: [id])
  participants       Participant[]
  PaymentInscription PaymentInscription[]

  @@map("inscriptions")
}

model Participant {
  id                String           @id @default(uuid())
  inscriptionId     String           @map("inscription_id")
  name              String
  birthDate         DateTime         @map("birth_date")
  typeInscriptionId String           @map("type_inscription_id")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")
  gender            genderType
  inscription       Inscription      @relation(fields: [inscriptionId], references: [id], onDelete: Cascade)
  typeInscription   TypeInscriptions @relation(fields: [typeInscriptionId], references: [id])

  @@map("participants")
}

model CacheRecords {
  id        String    @id @default(uuid())
  cacheKey  String    @unique
  accountId String    @map("account_id")
  expiresAt DateTime?
  createdAt DateTime  @default(now()) @map("created_at")
  payload   Json
  updatedAt DateTime  @updatedAt @map("updated_at")
  account   Accounts  @relation(fields: [accountId], references: [id])

  @@map("cache_records")
}

model OnSiteRegistration {
  id                String              @id @default(uuid())
  eventId           String              @map("event_id")
  phone             String?
  status            InscriptionStatus   @default(PAID)
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  responsible       String
  totalValue        Decimal             @db.Decimal(10, 2)
  OnSiteParticipant OnSiteParticipant[]
  event             Events              @relation(fields: [eventId], references: [id])

  @@map("on_site_registrations")
}

model OnSiteParticipant {
  id                   String                     @id @default(uuid())
  onSiteRegistrationId String                     @map("on_site_registration_id")
  name                 String
  gender               genderType
  createdAt            DateTime                   @default(now()) @map("created_at")
  updatedAt            DateTime                   @updatedAt @map("updated_at")
  payments             OnSiteParticipantPayment[]
  onSiteRegistration   OnSiteRegistration         @relation(fields: [onSiteRegistrationId], references: [id])

  @@map("on_site_participants")
}

model OnSiteParticipantPayment {
  id            String            @id @default(uuid())
  participantId String            @map("participant_id")
  paymentMethod PaymentMethod
  value         Decimal           @db.Decimal(10, 2)
  createdAt     DateTime          @default(now()) @map("created_at")
  participant   OnSiteParticipant @relation(fields: [participantId], references: [id])

  @@map("on_site_participant_payments")
}

model PaymentInscription {
  id                  String             @id @default(uuid())
  inscriptionId       String             @map("inscription_id")
  eventId             String             @map("event_id")
  accountId           String             @map("account_id")
  status              StatusPayment
  value               Decimal            @db.Decimal(10, 2)
  rejectionReason     String?            @map("rejection_reason")
  createdAt           DateTime           @default(now()) @map("created_at")
  updatedAt           DateTime           @updatedAt @map("updated_at")
  imageUrl            String             @map("image_url")
  financialMovementId String?
  account             Accounts           @relation(fields: [accountId], references: [id])
  event               Events             @relation(fields: [eventId], references: [id])
  financialMovement   FinancialMovement? @relation(fields: [financialMovementId], references: [id])
  inscription         Inscription        @relation(fields: [inscriptionId], references: [id])

  @@map("payment_inscription")
}

model FinancialMovement {
  id                 String               @id @default(uuid())
  eventId            String               @map("event_id")
  accountId          String               @map("account_id")
  type               TransactionType
  value              Decimal              @db.Decimal(10, 2)
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  account            Accounts             @relation(fields: [accountId], references: [id])
  event              Events               @relation(fields: [eventId], references: [id])
  paymentInscription PaymentInscription[]

  @@map("financial_movement")
}

model EventTickets {
  id             String       @id @default(uuid())
  eventId        String       @map("event_id")
  name           String
  description    String?
  quantity       Int
  price          Decimal      @db.Decimal(10, 2)
  available      Int
  expirationDate DateTime     @map("expiration_date")
  isActive       Boolean      @default(false) @map("is_active")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  event          Events       @relation(fields: [eventId], references: [id])
  TicketSales    TicketSale[]

  @@map("event_tickets")
}

model TicketSale {
  id          String              @id @default(uuid())
  ticketId    String              @map("ticket_id")
  accountId   String              @map("account_id")
  quantity    Int
  totalValue  Decimal             @db.Decimal(10, 2)
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")
  payments    TicketSalePayment[]
  account     Accounts            @relation(fields: [accountId], references: [id])
  ticket      EventTickets        @relation(fields: [ticketId], references: [id])
  ticketUnits TicketUnit[]

  @@map("ticket_sales")
}

model TicketSalePayment {
  id            String        @id @default(uuid())
  ticketSaleId  String        @map("ticket_sale_id")
  paymentMethod PaymentMethod
  value         Decimal       @db.Decimal(10, 2)
  createdAt     DateTime      @default(now()) @map("created_at")

  sale TicketSale @relation(fields: [ticketSaleId], references: [id])

  @@map("ticket_sale_payments")
}

model TicketUnit {
  id           String    @id @default(uuid())
  ticketSaleId String    @map("ticket_sale_id")
  qrCode       String    @unique
  usedAt       DateTime?
  createdAt    DateTime  @default(now()) @map("created_at")

  sale TicketSale @relation(fields: [ticketSaleId], references: [id])

  @@map("ticket_units")
}

model EventExpenses {
  id            String        @id @default(uuid())
  eventId       String        @map("event_id")
  description   String
  value         Decimal       @db.Decimal(10, 2)
  paymentMethod PaymentMethod
  responsible   String
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  event         Events        @relation(fields: [eventId], references: [id])

  @@map("event_expenses")
}

enum InscriptionStatus {
  PENDING
  UNDER_REVIEW
  PAID
  CANCELLED
}

enum roleType {
  USER
  MANAGER
  ADMIN
  SUPER
}

enum statusEvent {
  OPEN
  CLOSE
  FINALIZED
}

enum genderType {
  MASCULINO
  FEMININO
}

enum StatusPayment {
  APPROVED
  UNDER_REVIEW
  REFUSED
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum PaymentMethod {
  DINHEIRO
  PIX
  CARTAO
}
